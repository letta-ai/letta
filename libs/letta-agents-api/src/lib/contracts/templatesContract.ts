import { initContract } from '@ts-rest/core';
import { z } from 'zod';
import { extendZodWithOpenApi } from '@anatine/zod-openapi';
import type { AgentState } from '../_autogenerated/requests';

extendZodWithOpenApi(z);

const c = initContract();

interface CreatedAgentFromTemplateState {
  agents: AgentState[];
}

const createAgentsFromTemplate = c.mutation({
  method: 'POST',
  path: '/v1/templates/:project/:template_version',
  description: 'Creates agents given a template',
  summary: 'Create Agents from Template',
  pathParams: z.object({
    project: z.string().openapi({ description: 'The project slug' }),
    template_version: z.string().openapi({
      description:
        'The template version, formatted as {template-name}:{version-number} or {template-name}:latest',
    }),
  }),
  body: z.object({
    agent_name: z.string().optional().openapi({
      description:
        'The name of the agent, optional otherwise a random one will be assigned',
    }),
    memory_variables: z
      .record(z.string())
      .optional()
      .openapi({ description: 'The memory variables to assign to the agent' }),
    tool_variables: z
      .record(z.string())
      .optional()
      .openapi({ description: 'The tool variables to assign to the agent' }),
  }),
  responses: {
    201: c.type<CreatedAgentFromTemplateState>(),
  },
});

export const templatesContract = c.router({
  createAgentsFromTemplate,
});
