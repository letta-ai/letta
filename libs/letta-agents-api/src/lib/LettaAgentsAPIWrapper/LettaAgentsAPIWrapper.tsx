import { OpenAPI } from '../_autogenerated/requests';
import type { AxiosResponse } from 'axios';
import type { PropsWithChildren } from 'react';
import { useEffect } from 'react';
import type { AxiosRequestConfig } from 'axios';

OpenAPI.BASE = '/api/letta-agents/v1';
OpenAPI.HEADERS = {
  'Content-Type': 'application/json',
  'Cache-Control': 'no-cache',
};

export function LettaAgentsAPIWrapper({ children }: PropsWithChildren) {
  useEffect(() => {
    function resInterceptor(response: AxiosResponse<unknown>) {
      return response;
    }

    OpenAPI.interceptors.response.use(resInterceptor);

    return () => {
      OpenAPI.interceptors.response.eject(resInterceptor);
    };
  }, []);

  useEffect(() => {
    function authHeaderInterceptor(config: AxiosRequestConfig) {
      config.headers = {
        ...config.headers,
        Authorization: 'Bearer password',
      };

      return config;
    }

    OpenAPI.interceptors.request.use(authHeaderInterceptor);
    return () => {
      OpenAPI.interceptors.request.eject(authHeaderInterceptor);
    };
  }, []);

  return children;
}
